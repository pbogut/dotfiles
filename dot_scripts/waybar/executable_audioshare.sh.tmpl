#!/usr/bin/env bash
#=================================================
# name:   gaming
# author: author <author_contact>
# date:   09/09/2023
#=================================================
toggle=false
if [[ $1 == 'toggle' ]]; then
  toggle=true
fi

# {{- if eq .chezmoi.hostname "silverspoon" }} silverspoon [[[
speaker=$(pactl list sinks | grep 'Name: alsa_output\..*\.HiFi__Speaker' | sed 's,.*Name: ,,')
audioshare=$(pactl list sinks | grep 'Name: Audio Share Sink' | sed 's,.*Name: ,,')
# silverspoon ]]] {{- end }}

current=$(pactl get-default-sink)

__switch_sink() {
  sink="$1"
  pactl set-default-sink "$sink"
  while read -r input_id; do
    pactl move-sink-input "$input_id" "$sink"
  done <<< "$(pactl list short sink-inputs | awk '{print $1}')"
}

if [[ $current == "$audioshare" ]]; then
  if $toggle; then
    __switch_sink "$speaker"
    echo ""
  else
    echo ""
  fi
else
  if $toggle; then
    if ! pgrep -x as-cmd > /dev/null; then
      as-cmd -b "$(ip addr | grep 192 | awk '{print $2}' | sed 's,/.*$,,')" &
    fi
    __switch_sink "$audioshare"
    echo ""
  else
    killall as-cmd >/dev/null 2>&1
    echo ""
  fi
fi
